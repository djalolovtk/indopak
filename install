#!/bin/bash

# Define paths
down="$EXTERNAL_STORAGE/Download"
dpak="$EXTERNAL_STORAGE/Download"
quickbms_dir="$PREFIX/share/quickbms"
tx="$HOME/indopak"
txz="$PREFIX/bin"
pak_dir="$dpak/pak"

# Color definitions
NOCOLOR='\033[0m'
LIGHTGREEN='\033[1;32m'
YELLOW='\033[1;33m'

# Clear the screen
clear

# Create necessary directories
mkdir -p "$tx/output" "$tx/etc" "$pak_dir"

# Move pubg.bms to the etc directory if it exists
if [ -f "pubg.bms" ]; then
    chmod +x pubg.bms
    mv pubg.bms "$tx/etc/"
fi

# Copy the indopak script to the bin directory
chmod +x indopak
cp -rf indopak "$txz"

# Ensure the download directory exists
mkdir -p "$down" "$dpak"

# Install function
install() {
    echo "Please wait .."
    sleep 2

    # Recreate quickbms directory and copy files
    rm -rf "$quickbms_dir"
    mkdir -p "$quickbms_dir"
    
    if [ -f "quickbms_4gb_files" ]; then
        chmod +x quickbms_4gb_files
        cp -rf quickbms_4gb_files "$quickbms_dir/"
    fi

    if [ -f "quickbms" ]; then
        chmod +x quickbms
        cp -rf quickbms "$quickbms_dir/"
    fi
    
    chmod +x "$tx/etc/pubg.bms" "$tx/indopak"
    
    printf "\n"
    FILE="$quickbms_dir/quickbms"
    if [ -f "$FILE" ]; then
        echo -e "${LIGHTGREEN}Tools are checking the package....${NOCOLOR}"
        sleep 5
    else
        echo -e "${YELLOW}QuickBMS installation failed! Please check the files.${NOCOLOR}"
        exit 1
    fi
}

# Run the install function
install

# Final message
clear
echo " ======================= "
echo -e " ${LIGHTGREEN}Installation of indopak completed. ${NOCOLOR}"
echo " ======================= "
echo " "
echo -e " ${YELLOW}Please type exit and restart your TERMUX. ${NOCOLOR}"
echo " "
echo -e " Then type ${LIGHTGREEN}indopak ${NOCOLOR}(all lowercase)."
exit
