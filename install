#!/bin/bash

# Определяем пути
down="$EXTERNAL_STORAGE/Download"
dpak="$EXTERNAL_STORAGE/Download"
quickbms_dir="$PREFIX/share/quickbms"
tx="$HOME/indopak"
txz="$PREFIX/bin"
pak_dir="$dpak/pak"

# Цветовые определения
NOCOLOR='\033[0m'
LIGHTGREEN='\033[1;32m'
YELLOW='\033[1;33m'

# Очищаем экран
clear

# Создаем необходимые директории
mkdir -p "$tx/output" "$tx/etc" "$pak_dir"

# Перемещаем pubg.bms в директорию etc, если она существует
if [ -f "pubg.bms" ]; then
    chmod +x pubg.bms
    mv pubg.bms "$tx/etc/"
else
    echo -e "${YELLOW}Файл pubg.bms не найден!${NOCOLOR}"
fi

# Проверяем наличие файла indopak
if [ -f "indopak" ]; then
    chmod +x indopak
    cp -rf indopak "$txz/"
else
    echo -e "${YELLOW}Файл indopak не найден! Убедитесь, что он существует.${NOCOLOR}"
    exit 1
fi

# Убедимся, что директории загрузки существуют
mkdir -p "$down" "$dpak"

# Функция установки
install() {
    echo "Пожалуйста, подождите .."
    sleep 2

    # Удаляем и создаем директорию quickbms
    rm -rf "$quickbms_dir"
    mkdir -p "$quickbms_dir"
    
    # Копируем необходимые файлы в quickbms_dir
    for file in quickbms_4gb_files quickbms; do
        if [ -f "$file" ]; then
            chmod +x "$file"
            cp -rf "$file" "$quickbms_dir/"
        else
            echo -e "${YELLOW}Файл $file не найден! Проверьте наличие файлов.${NOCOLOR}"
            exit 1
        fi
    done
    
    chmod +x "$tx/etc/pubg.bms" "$tx/indopak"
    
    printf "\n"
    FILE="$quickbms_dir/quickbms"
    if [ -f "$FILE" ]; then
        echo -e "${LIGHTGREEN}Инструменты проверяют пакет....${NOCOLOR}"
        sleep 5
    else
        echo -e "${YELLOW}Установка QuickBMS не удалась! Проверьте файлы.${NOCOLOR}"
        exit 1
    fi
}

# Запускаем функцию установки
install

# Финальное сообщение
clear
echo " ======================= "
echo -e " ${LIGHTGREEN}Установка indopak завершена. ${NOCOLOR}"
echo " ======================= "
echo " "
echo -e " ${YELLOW}Пожалуйста, введите exit и перезапустите TERMUX. ${NOCOLOR}"
echo " "
echo -e " Затем введите ${LIGHTGREEN}indopak ${NOCOLOR}(все буквы строчные)."
exit
