down="$EXTERNAL_STORAGE/Download"
dpak="$EXTERNAL_STORAGE/Download/pak"
quickbms_dir="$PREFIX/share/quickbms"
tx="$HOME/indopak"
txz="$PREFIX/bin"

NOCOLOR='\033[0m'
LIGHTGREEN='\033[1;32m'
YELLOW='\033[1;33m'

clear

# Create necessary directories
mkdir -p "$tx/output" "$tx/etc"
cd "$tx" || exit

# Move pubg.bms file if it exists
if [[ -f pubg.bms ]]; then
    chmod +x pubg.bms
    mv pubg.bms "$tx/etc"
fi

# Copy indopak
chmod +x indopak
yes | cp -rf indopak "$txz"

# Check for pak directory and create it if it doesn't exist
if [[ ! -d "$dpak" ]]; then
    echo "Creating pak directory..."
    mkdir -p "$dpak"
else
    echo "Pak directory already exists."
fi

# Install function
function install {
    echo "Please wait ..."
    sleep 2

    # Remove old QuickBMS directory
    echo "Removing old QuickBMS directory..."
    rm -rf "$quickbms_dir"
    mkdir -p "$quickbms_dir"

    # Copy necessary files
    echo "Copying QuickBMS files..."
    chmod +x quickbms_4gb_files
    yes | cp -rf quickbms_4gb_files "$quickbms_dir"
    chmod +x quickbms
    yes | cp -rf quickbms "$quickbms_dir"
    
    # Set executable permissions for the scripts
    chmod +x etc/pubg.bms indopak

    # Check for quickbms
    printf "\n"
    FILE="$quickbms_dir/quickbms"
    if [[ -f "$FILE" ]]; then
        echo -e "${LIGHTGREEN}Tools are checking the package....${NOCOLOR}"
        sleep 5
    else
        echo "QuickBMS not found. Installation failed."
        exit 1
    fi
}

install
clear

echo " ======================= "
echo -e " ${LIGHTGREEN}Indopak installation completed "
echo " ======================= "
echo " "
echo -e " ${YELLOW}Please type exit and restart TERMUX ${NOCOLOR} "
echo " "
echo -e " Then type ${LIGHTGREEN}indopak ${NOCOLOR}(all lowercase) "
exit
